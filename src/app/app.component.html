<div class="app-container">
  <!-- Persona Selection (shows if no persona) -->
  <app-persona-selection></app-persona-selection>

  <!-- Debug Info (temporary) -->
  <div style="position: fixed; top: 0; right: 0; background: rgba(0,0,0,0.8); color: white; padding: 10px; font-size: 12px; z-index: 9999; max-width: 300px;">
    <div>hasPersona: {{ walletService.hasPersona() }}</div>
    <div>persona: {{ walletService.persona() | json }}</div>
    <div>balance: {{ walletService.balance() }}</div>
  </div>

  @if (walletService.hasPersona()) {
    <app-game-header></app-game-header>
    
    <header class="app-header">
      <div class="header-content">
        <div class="logo">
          <h1 class="rainbow-text">üè™ My Store Manager Game!</h1>
          @if (walletService.persona()) {
            <div class="persona-info">
              <span class="persona-badge" [class.seller]="walletService.persona()?.type === PersonaType.SELLER"
                    [class.buyer]="walletService.persona()?.type === PersonaType.BUYER">
                {{ walletService.persona()?.type === PersonaType.SELLER ? 'üè™ Seller' : 'üõçÔ∏è Buyer' }}
              </span>
              <span class="persona-name">{{ walletService.persona()?.name }}</span>
            </div>
          }
        </div>

        <div class="wallet-and-nav">
          <app-wallet-display></app-wallet-display>
          
          <nav class="mode-switcher">
            @if (walletService.persona()?.type === PersonaType.SELLER) {
              <button 
                [class]="'btn mode-button ' + (currentMode() === AppMode.INVENTORY ? 'btn-primary' : 'btn-secondary')"
                (click)="switchMode(AppMode.INVENTORY)">
                <span class="button-icon">üì¶</span>
                <span>Add Items</span>
              </button>
              <button 
                [class]="'btn mode-button ' + (currentMode() === AppMode.SALES ? 'btn-primary' : 'btn-secondary')"
                (click)="switchMode(AppMode.SALES)">
                <span class="button-icon">üí∞</span>
                <span>Sell Items</span>
              </button>
              <app-sales-history></app-sales-history>
            }
            
            @if (walletService.persona()?.type === PersonaType.BUYER) {
              <button 
                class="btn mode-button btn-success"
                (click)="openPaymentScanner()">
                <span class="button-icon">üì±</span>
                <span>Scan to Pay</span>
              </button>
            }
            
            <app-achievements></app-achievements>
          </nav>
        </div>
      </div>
    </header>

    <main class="app-main">
      @if (walletService.persona()?.type === PersonaType.SELLER) {
        @if (currentMode() === AppMode.INVENTORY) {
          <app-inventory-management></app-inventory-management>
        } @else {
          <app-sales></app-sales>
        }
      }
      
      @if (walletService.persona()?.type === PersonaType.BUYER) {
        <div class="buyer-view">
          <div class="buyer-hero">
            <h2>üëã Welcome, {{ walletService.persona()?.name }}!</h2>
            <p>Ready to shop? Scan QR codes to pay for your purchases!</p>
            
            <div class="buyer-stats">
              <div class="stat-card">
                <div class="stat-icon">üí∞</div>
                <div class="stat-content">
                  <div class="stat-label">Wallet Balance</div>
                  <div class="stat-value">\${{ walletService.balance().toFixed(2) }}</div>
                </div>
              </div>
              
              <div class="stat-card">
                <div class="stat-icon">üõçÔ∏è</div>
                <div class="stat-content">
                  <div class="stat-label">Total Purchases</div>
                  <div class="stat-value">{{ walletService.transactions().filter(t => t.type === 'debit').length }}</div>
                </div>
              </div>
            </div>

            <button class="btn btn-primary btn-large" (click)="openPaymentScanner()">
              üì± Scan QR Code to Pay
            </button>
          </div>
        </div>
      }
    </main>

    <footer class="app-footer">
      <div class="footer-content">
        <p>üåü Keep playing to level up and unlock achievements! üåü</p>
        <p class="footer-stats">
          Level {{ gameService.level() }} ‚Ä¢ {{ gameService.coins() }} coins ‚Ä¢ {{ gameService.score() }} points
        </p>
      </div>
    </footer>

    <!-- QR Scanner for Buyers -->
    @if (showQRScanner()) {
      <app-qr-scanner-payment
        (paymentCompleted)="onPaymentCompleted()"
        (closed)="closePaymentScanner()">
      </app-qr-scanner-payment>
    }
  }
</div>

