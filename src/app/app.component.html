<div class="app-container">
  <!-- Persona Selection (shows if no persona) -->
  <app-persona-selection></app-persona-selection>

  @if (walletService.hasPersona()) {
    <app-game-header></app-game-header>
    
    <header class="app-header">
      <div class="header-content">
        <div class="wallet-and-nav">
          <app-wallet-display></app-wallet-display>
          
          <nav class="mode-switcher">
            @if (walletService.persona()?.type === PersonaType.SELLER) {
              <button 
                [class]="'btn mode-button ' + (currentMode() === AppMode.INVENTORY ? 'btn-primary' : 'btn-secondary')"
                (click)="switchMode(AppMode.INVENTORY)">
                <span class="button-icon">üì¶</span>
                <span>Add Items</span>
              </button>
              <button 
                [class]="'btn mode-button ' + (currentMode() === AppMode.SALES ? 'btn-primary' : 'btn-secondary')"
                (click)="switchMode(AppMode.SALES)">
                <span class="button-icon">üí∞</span>
                <span>Sell Items</span>
              </button>
            }
            
            @if (walletService.persona()?.type === PersonaType.BUYER) {
              <button 
                class="btn mode-button btn-success"
                (click)="openPaymentScanner()">
                <span class="button-icon">üì±</span>
                <span>Scan to Pay</span>
              </button>
            }
          </nav>
        </div>
      </div>
    </header>

    <main class="app-main">
      @if (walletService.persona()?.type === PersonaType.SELLER) {
        @if (currentMode() === AppMode.INVENTORY) {
          <app-inventory-management></app-inventory-management>
        } @else {
          <app-sales></app-sales>
        }
      }
      
      @if (walletService.persona()?.type === PersonaType.BUYER) {
        <div class="buyer-view">
          <div class="buyer-hero">
            <h2>üëã Welcome, {{ walletService.persona()?.name }}!</h2>
            <p>Ready to shop? Scan QR codes to pay for your purchases!</p>
            
            <div class="buyer-stats">
              <div class="stat-card">
                <div class="stat-icon">üí∞</div>
                <div class="stat-content">
                  <div class="stat-label">Wallet Balance</div>
                  <div class="stat-value">{{ walletService.balance() | currencyFormat }}</div>
                </div>
              </div>
              
              <div class="stat-card">
                <div class="stat-icon">üõçÔ∏è</div>
                <div class="stat-content">
                  <div class="stat-label">Total Purchases</div>
                  <div class="stat-value">{{ getTotalPurchases() }}</div>
                </div>
              </div>
            </div>

            <button class="btn btn-primary btn-large" (click)="openPaymentScanner()">
              üì± Scan QR Code to Pay
            </button>
          </div>
        </div>
      }
    </main>

    <footer class="app-footer">
      <div class="footer-content">
        <!-- Persona Info -->
        @if (walletService.persona()) {
          <div class="footer-persona">
            <span class="persona-badge" [class.seller]="walletService.persona()?.type === PersonaType.SELLER"
                  [class.buyer]="walletService.persona()?.type === PersonaType.BUYER">
              {{ walletService.persona()?.type === PersonaType.SELLER ? 'Seller' : 'Buyer' }}
            </span>
            <span class="persona-name">{{ walletService.persona()?.name }}</span>
          </div>
        }
        
        <!-- Game Stats -->
        <div class="footer-stats">
          <span>Level {{ gameService.level() }}</span>
          <span>{{ gameService.coins() }} coins</span>
          <span>{{ gameService.score() }} points</span>
        </div>
        
        <!-- Action Buttons -->
        <div class="footer-actions">
          @if (walletService.persona()?.type === PersonaType.SELLER) {
            <app-sales-history></app-sales-history>
          }
          <app-achievements></app-achievements>
        </div>
      </div>
    </footer>

    <!-- QR Scanner for Buyers -->
    @if (showQRScanner()) {
      <app-qr-scanner-payment
        (paymentCompleted)="onPaymentCompleted()"
        (closed)="closePaymentScanner()">
      </app-qr-scanner-payment>
    }
  }
</div>

